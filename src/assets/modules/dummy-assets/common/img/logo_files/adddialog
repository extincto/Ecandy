AddDialog=function(n,t){var i=this;i.drawningboard=n;i.dom;i.selected;i.list;i.type=t;i.adding=!1;i.editmode=!1;i.status;i.owner;i.loading=!1;i.currentpage=1;i.randomseed=Math.random()*1e3;i.confirm=function(){};i.show=function(){i.drawningboard.api.loadTemplate("adddialog",function(n){if(i.dom=$(n),$("#logobody").append(i.dom),i.dom.hide(),i.dom.fadeIn(200),i.drawningboard.plan&&i.drawningboard.plan!="0"&&(i.type=="logo"||i.type=="icon")){var t=new Messagebox(i.drawningboard,i.drawningboard.api.dictionary.adddialog_purchase_modification_message,undefined,i.drawningboard.api.dictionary.ok);t.show()}i.drawningboard.messagemenu=i;i.status=i.dom.find(".admin-mode .status select");i.owner=i.dom.find(".admin-mode .admin select");i.drawningboard.ownermode&&(i.dom.find(".admin-mode").show(),i.drawningboard.fullaccess||(i.dom.find(".admin-mode .admin").hide(),i.dom.find(".status select option[value='4']").remove()),i.loadowners());i.registerevents();i.drawningboard.icon&&i.drawningboard.firstdisplay?(i.retrievelogo(i.drawningboard.icon),i.dom.hide()):i.drawningboard.fontsloaded?i.startpopup():i.drawningboard.loadfonts(undefined,i.startpopup)})};i.startpopup=function(){i.drawningboard.endloading();i.type=="logo"?i.showlogodialog():i.type=="icon"?i.showicondialog():i.showshapedialog()};i.back=function(){if(i.dom.fadeIn(200),i.dom.find(".search-wrapper input").focus(),i.dom.find(".search-wrapper input").select(),i.drawningboard.messagemenu=i,i.drawningboard.plan&&i.drawningboard.plan!="0"&&(i.type=="logo"||i.type=="icon")){var n=new Messagebox(i.drawningboard,i.drawningboard.api.dictionary.adddialog_purchase_modification_message,undefined,i.drawningboard.api.dictionary.ok);n.show()}};i.loadiconfonts=function(n,t){var r=[];n.text_list.length>0&&$.each(n.text_list,function(n,t){var i=JSON.parse(t.format);r.push({name:i.font})});i.drawningboard.loadfonts(r,t)};i.retrievelogo=function(n){$.ajax({type:"post",url:i.drawningboard.api.logo+"get",data:JSON.stringify({guid:n}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){t.status==1?(i.list=[t.obj],i.loadiconfonts(t.obj,function(){i.proccessaddlogo(n);i.drawningboard.endloading()})):(i.drawningboard.firstdisplay=!1,i.hide())})};i.hide=function(){i.dom.fadeOut(200,function(){i.type!="icon"?i.dom.remove():(i.adding=!1,i.dom.find(".load").hide());i.drawningboard.messagemenu=undefined})};i.loadowners=function(){i.currentpage=1;var n=$(".add-dialog .topbar .admin select");$.ajax({type:"post",url:i.drawningboard.api.owner+"list",dataType:"json"}).done(function(t){owner_list=t.obj;$.each(owner_list,function(t,i){var u=$("<option>"+i.key+"<\/option>"),r=$("<option>"+i.key+"<\/option>");u.attr("value",i.id);r.attr("value",i.id);n.append(r)})})};i.registerevents=function(){i.dom.find("div.close").on("click",function(){i.hide()});i.dom.find("td.cancel-td").on("click",function(){i.hide()});i.dom.find("td.confirm-td").on("click",function(){i.add()});i.dom.find("td.search-td").on("click",function(){i.dom.find(".search-icon").trigger("mouseup")});i.dom.find("td.edit-td").on("click",function(){i.editicon()})};i.loadcategories=function(){var n,t;i.currentpage=1;i.retrievelogos(1,i.drawningboard.category);n=i.dom.find(".category-others ul.root");n.empty();i.dom.find(".leftbar .load").show();t=i.drawningboard.ownermode?i.status.val():1;$.ajax({type:"post",url:i.drawningboard.api.category+"list",data:JSON.stringify({status:t,owner:i.owner.val(),loginKey:i.drawningboard.ownerkey}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(t){var r,u,f;if(t.status=="1"){r=$('<li catid="0"><span class="name" lang="category_all"><\/span><\/li>');r=i.drawningboard.api.fillTemplateLanguage(r);n.append(r);n.find("li[catid='0']").addClass("selected");t.obj&&t.obj.length>0&&($.each(t.obj,function(n,t){t.description=i.drawningboard.api.dictionary["category_"+t.id];t.description==undefined&&(t.description="undefined")}),u=t.obj,u.sort(function(n,t){return n.description.toUpperCase()>t.description.toUpperCase()?1:n.description<t.description?-1:void 0}),f=0,$.each(u,function(t,i){var r,u,e;if(i.qtd!=0)if(r=$('<li><i class="fa fa-minus"><\/i><span class="name"><\/span><span>(<\/span><span class="qtd"><\/span><span>)<\/span><\/li>'),r.find(".name").html(i.description),r.find(".qtd").html(i.qtd),r.attr("catid",i.id),f+=i.qtd,n.append(r),i.subcategory)if(u=$("<ul><\/ul>"),u.attr("catid",i.id),u.hide(),e=0,$.each(i.subcategory,function(n,t){if(t.qtd!=0){e++;r.find(".fa").removeClass("fa-minus").addClass("fa-plus");var i=$('<li><span class="name"><\/span><span>(<\/span><span class="qtd"><\/span><span>)<\/span><\/li>');i.find(".name").html(t.description);i.find(".qtd").html(t.qtd);i.attr("catid",t.id);u.append(i)}}),e>0){u.hide();n.append(u);r.find(".fa").on("click",function(){$(u).is(":visible")?(u.slideUp("fast"),r.find(".fa").removeClass("fa-minus").addClass("fa-plus")):(u.slideDown("fast"),r.find(".fa").removeClass("fa-plus").addClass("fa-minus"))})}else r.find(".fa").remove(),r.find(".name").css("padding-left","18px");else r.find(".fa").remove(),r.find(".name").css("padding-left","18px")}));n.find("li").on("click",function(){n.find("li").removeClass("selected");$(this).addClass("selected");i.currentpage=1;i.retrievelogos(1,$(this).attr("catid"));i.dom.find(".curpage").html(1)});i.dom.find(".leftbar .load").fadeOut("fast");i.drawningboard.category&&(n.find("li").removeClass("selected"),n.find("li[catid='"+i.drawningboard.category+"']").addClass("selected"))}else obj.status=="0"&&i.dom.find(".body .load").fadeOut("fast")})};i.showicondialog=function(){i.dom.find(".admin-mode").hide();i.dom.find(".title-name").html(i.drawningboard.api.dictionary.adddialog_icon_title);i.dom.find(".title .icon").attr("src","img/Add_Icon.svg");i.dom.find(".list").css("height","100%");i.dom.find(".search-wrapper").show();i.dom.find(".pagination").hide();i.dom.find(".confirm-td").hide();i.dom.find(".search-td").show();i.dom.find(".search-icon").on("mouseup",function(){i.dom.find(".search-wrapper input").val().trim()!=""&&i.starticonsearch()});i.dom.find(".search-wrapper input").focus();i.dom.find(".search-wrapper input").on("keyup",function(n){n.keyCode==13&&i.dom.find(".search-icon").trigger("mouseup")});i.dom.find(".list-wrapper").on("scroll",function(){$(this)[0].offsetHeight+$(this).scrollTop()>=$(this)[0].scrollHeight&&(i.loading||(i.dom.find(".body .load").fadeIn("fast"),i.iconsearch()))})};i.iconsearch=function(){var n=i.dom.find(".search-wrapper input").val();i.loading=!0;$.ajax({type:"post",url:i.drawningboard.api.noun+"search",data:JSON.stringify({term:n,limit:200,page:i.currentpage}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(n){if(n.status=="1"){if(i.currentpage++,i.list=i.list?i.list.concat(n.obj):n.obj,i.list){$.each(n.obj,function(n,t){var r=$('<div class="item"><\/div>'),u=$('<img height="84px" width="84px">');u.attr("src",t.pngurl);r.attr("iconid",t.id);r.append(u);i.dom.find(".list-wrapper").append(r);i.dom.find(".body .load").fadeOut("fast");i.loading=!1});i.list.length<=18&&i.showiconendmessage();i.dom.find(".list-wrapper .item").unbind("click").on("click",function(){$(this).hasClass("selected")?i.add():(i.selected=$(this),i.dom.find(".list-wrapper .item").removeClass("selected"),$(this).addClass("selected"))})}}else i.showiconendmessage()})};i.addicon=function(){if(!i.adding){i.dom.find(".body .load").fadeIn("fast");i.adding=!0;var n=i.selected.attr("iconid"),t=$.grep(i.list,function(t){return t.id==n})[0];$.ajax({type:"post",url:i.drawningboard.api.noun+"svg",data:JSON.stringify({url:t.svgurl}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(t){i.drawningboard.clipid++;i.drawningboard.selector.target=[];i.drawningboard.plan=t.obj.paid_item_number;i.drawningboard.toolbar.proccesssvg(t.obj.svg,n);i.hide()})}};i.showiconendmessage=function(){var n;i.dom.find(".list-wrapper .message").remove();n=i.currentpage==1?$('<div class="message"><span>No results to show.<\/span><\/div>'):$('<div class="message"><span>No more results to show.<\/span><\/div>');i.dom.find(".list-wrapper").append(n);i.dom.find(".body .load").fadeOut("fast")};i.starticonsearch=function(){i.list=undefined;i.currentpage=1;i.dom.find(".body .load").fadeIn("fast");i.dom.find(".body .search-wrapper").addClass("searching");i.dom.find(".body .list-wrapper").addClass("searching");i.dom.find(".confirm-td").show();i.dom.find(".search-td").hide();i.dom.find(".list-wrapper").empty();i.iconsearch()};i.showlogodialog=function(){i.dom.find(".wrapper").css({width:"90%",height:"90%"}).addClass("logowindow");i.dom.find(".list").css("height","auto");i.dom.find(".leftbar").show().css("height","86%");i.dom.find(".title-name").html(i.drawningboard.api.dictionary.adddialog_logo_title);i.dom.find(".title .icon").attr("src","img/Add_Logo.svg");i.dom.find(".body .load").hide();i.dom.find(".body").css({height:"86%",width:"calc(100% - 280px)","overflow-y":"scroll"});i.loadcategories();i.status.on("change",function(){i.loadcategories()});i.owner.on("change",function(){i.loadcategories()})};i.retrievelogos=function(n,t){var r;i.dom.find(".body .load").is(":visible")||(i.dom.find(".body .load").fadeIn("fast"),i.dom.find(".list-wrapper").empty(),r=i.drawningboard.ownermode?i.status.val():1,$.ajax({type:"post",url:i.drawningboard.api.logo+"list",data:JSON.stringify({page:n,category:t,pagesize:15,owner:i.owner.val(),status:r,loginKey:i.drawningboard.ownerkey,randomseed:i.randomseed}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){var r,u,f,t;if(n.status=="1"){if(i.list=n.obj,i.list&&$.each(i.list,function(n,t){var u=getthumb(t,i.drawningboard.companyname),r=$('<div class="item"><\/div>');r.attr("svgid",t.id);r.append(u.svg);i.dom.find(".list-wrapper").append(r);i.dom.find(".body .load").fadeOut("fast")}),n.vars.pages>1){for(i.dom.find(".totalpage").hide(),i.dom.find(".paginationOf").hide(),i.dom.find(".curpage").hide(),r=i.dom.find(".centerpagination"),r.html(""),$(".firstpage").remove(),$(".lastpage").remove(),u=n.vars.curpage<3?1:n.vars.curpage-2,f=n.vars.curpage+2<=n.vars.pages&&n.vars.curpage>2?n.vars.curpage+2:n.vars.curpage<=2&&n.vars.pages>=5?5:n.vars.pages,i.dom.find(".pagination-wrapper").prepend('<span data-page="1" class="firstpage">&#171;<\/span>'),t=u;t<=f;t++)r.append('<span data-page="'+t+'" class="logopage '+(t==n.vars.curpage?"active":"")+'">'+t+"<\/span>");if(n.vars.pages>6&&n.vars.curpage+2<n.vars.pages&&r.append('<span class="Points deactivated">...<\/span>'),n.vars.pages>5&&n.vars.curpage+2<n.vars.pages&&r.append('<span data-page="'+n.vars.pages+'" class="logopage '+(n.vars.pages==n.vars.curpage?"active":"")+'">'+n.vars.pages+"<\/span>"),n.vars.curpage<n.vars.pages&&i.dom.find(".pagination-wrapper").append('<span class="lastpage" > &#187; <\/span>'),i.dom.find(".pagination-wrapper").css("visibility","visible"),i.dom.find(".pagination-wrapper .next").unbind("mouseup"),i.dom.find(".pagination-wrapper .previous").unbind("mouseup"),n.vars.pages>n.vars.curpage){i.dom.find(".pagination-wrapper .next").removeClass("disabled");i.dom.find(".pagination-wrapper .next").on("mouseup",function(){i.nextpage()});$(".lastpage").on("click",function(){i.page(n.vars.pages)}).removeClass("disable")}else i.dom.find(".pagination-wrapper .next").addClass("disabled"),$(".lastpage").addClass("disabled");if(n.vars.curpage>1){i.dom.find(".curpage").html(n.vars.curpage);i.dom.find(".pagination-wrapper .previous").removeClass("disabled");i.dom.find(".pagination-wrapper .previous").on("mouseup",function(){i.prevpage()});$(".firstpage").on("click",function(){i.page(1)}).removeClass("disable")}else i.dom.find(".pagination-wrapper .previous").addClass("disabled"),$(".firstpage").addClass("disabled");$(".logopage").on("click",function(){i.page($(this).attr("data-page"))})}else i.dom.find(".pagination-wrapper").css("visibility","hidden");i.dom.find(".list-wrapper .item").on("click",function(){if($(this).hasClass("selected"))i.add();else{i.selected=$(this).find("svg").first();var n=$.grep(i.list,function(n){return n.id==i.selected.parent().attr("svgid")})[0];n.status==2?(i.dom.find(".buttombar table").addClass("withedit"),i.editmode=!0):(i.dom.find(".buttombar table").removeClass("withedit"),i.editmode=!1);i.dom.find(".list-wrapper .item").removeClass("selected");$(this).addClass("selected")}})}i.dom.find(".body .load").fadeOut("fast")}))};i.nextpage=function(){i.currentpage=parseInt(i.dom.find(".curpage").html())+1;i.type=="logo"?i.retrievelogos(i.currentpage,i.dom.find(".category-others ul.root li.selected").attr("catid")):i.retrieveshapes()};i.prevpage=function(){i.currentpage=parseInt(i.dom.find(".curpage").html())-1;i.type=="logo"?i.retrievelogos(i.currentpage,i.dom.find(".category-others ul.root li.selected").attr("catid")):i.retrieveshapes()};i.page=function(n){i.type=="logo"&&i.retrievelogos(n,i.dom.find(".category-others ul.root li.selected").attr("catid"))};i.retrieveshapes=function(){i.dom.find(".list-wrapper").empty();i.dom.find(".body .load").show();envelope={};envelope.status=i.drawningboard.ownermode?i.status.val():3;envelope.page=i.currentpage;envelope.owner=i.owner.val();$.ajax({type:"post",url:i.drawningboard.api.shape+"list",data:JSON.stringify(envelope),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){if(n.status=="1"){if(i.list=n.obj,i.list&&i.list.length&&$.each(i.list,function(n,t){var u=getthumb(t,null),r=$('<div class="item"><\/div>');r.attr("shapes-group-id",t.id);r.append(u.svg);i.dom.find(".list-wrapper").append(r)}),i.dom.find(".body .load").fadeOut("fast"),n.vars.pages>1){if(i.dom.find(".totalpage").html(n.vars.pages),i.dom.find(".curpage").html(n.vars.curpage),i.dom.find(".pagination-wrapper").css("visibility","visible"),i.dom.find(".pagination-wrapper .next").unbind("mouseup"),i.dom.find(".pagination-wrapper .previous").unbind("mouseup"),n.vars.pages>n.vars.curpage){i.dom.find(".pagination-wrapper .next").removeClass("disabled");i.dom.find(".pagination-wrapper .next").on("mouseup",function(){i.nextpage()})}else i.dom.find(".pagination-wrapper .next").addClass("disabled");if(n.vars.curpage>1){i.dom.find(".pagination-wrapper .previous").removeClass("disabled");i.dom.find(".pagination-wrapper .previous").on("mouseup",function(){i.prevpage()})}else i.dom.find(".pagination-wrapper .previous").addClass("disabled")}else i.dom.find(".pagination-wrapper").css("visibility","hidden");i.dom.find(".list-wrapper .item").on("click",function(){$(this).hasClass("selected")?i.add():(i.dom.find(".list-wrapper .item").removeClass("selected"),$(this).addClass("selected"),i.selected=$(this).find("svg"))})}else n.status=="0"&&i.dom.find(".body .load").fadeOut("fast")})};i.showshapedialog=function(){i.dom.find(".title-name").html(i.drawningboard.api.dictionary.adddialog_shape_title);i.dom.find(".title .icon").attr("src","img/Add_Shape.svg");i.retrieveshapes();i.status.on("change",function(){i.currentpage=1;i.retrieveshapes()});i.owner.on("change",function(){i.currentpage=1;i.retrieveshapes()})};i.add=function(){i.selected!=undefined&&(i.type=="logo"?i.addlogo():i.type=="icon"?i.addicon():i.proccessaddlogo(null,!0))};i.addshape=function(){var r,n;if(!i.adding){i.adding=!0;var u=i.selected[0],t=$.grep(i.list,function(n){return n.id==i.selected.parent().attr("svgid")})[0],f=t.gradient;i.drawningboard.clipid++;r=t.width>t.height?t.width:t.height;n=new Clip(u,f,i.drawningboard);n.scalex=200/r;n.scaley=200/r;n.id=i.drawningboard.clipid;n.start();i.drawningboard.selector.setnewclipstate(n);i.drawningboard.selector.select([n],!0);i.drawningboard.selector.changed=1;i.drawningboard.selector.save();i.drawningboard.selector.explodedmode&&i.drawningboard.selector.endexplodedmode();i.hide()}};i.proccessaddlogo=function(n,t){var u,r,f;if(typeof t=="undefined"&&(t=!1),t?u=$.grep(i.list,function(n){return n.id==i.selected.parent().attr("shapes-group-id")})[0]:(u=n?$.grep(i.list,function(t){return t.guid==n})[0]:$.grep(i.list,function(n){return n.id==i.selected.parent().attr("svgid")})[0],u.dominant_color&&i.drawningboard.toolbar.setdominantcolor(u.dominant_color),u.background_color&&(i.drawningboard.background.setcolor(u.background_color),i.drawningboard.showbackground=!0,$("#colorpicker_bg .colpick_use_background > i").removeClass("fa-square-o").addClass("fa-check-square-o")),i.drawningboard.plan=u.paid_item_number),i.drawningboard.clipid++,$.each(u.shape_list,function(n,t){t.gradient||(t.gradient=new Gradient,t.gradient.decode(t.color));r=new Clip($(t.svg)[0],t.gradient,i.drawningboard);r.note=t.note;r.x=t.offset_x/t.scale_x;r.y=t.offset_y/t.scale_y;r.id=i.drawningboard.clipid;r.offset.x=u.width/t.scale_x;r.offset.y=u.height/t.scale_y;r.scalex=t.scale_x;r.scaley=t.scale_y;r.rotation=parseInt(t.rotation);r.flipx=parseInt(t.flip_x);r.flipy=parseInt(t.flip_y);r.groupid=t.group_id;r.start();i.drawningboard.selector.setnewclipstate(r);i.drawningboard.clipid++}),t||($.each(u.text_list,function(n,t){var f,e,c,o,s,h;t.gradient||(t.gradient=new Gradient,t.gradient.decode(t.color));f=JSON.parse(t.format);e=JSON.parse(t.curvedline);i.drawningboard.companyname&&i.drawningboard.companyname!="false"&&(c="",f.text.trim().replaceAll("  "," ").replaceAll("  "," ")=="Company Name"?partName=i.drawningboard.companyname:(o=i.drawningboard.companyname.indexOf(" "),o>0?(s=i.drawningboard.companyname.substring(0,o),h=i.drawningboard.companyname.substring(o+1)):(s=i.drawningboard.companyname,h=""),partName=f.text.trim()=="Company"?s:f.text.trim()=="Name"?h:f.text),f.text=partName);f.text!=""&&(r=new Text(f.text,f.font,0,t.gradient,i.drawningboard,0,0,i.drawningboard.clipid),r.x=t.offset_x/t.scale_x,r.y=t.offset_y/t.scale_y,r.format.bold=f.bold,r.format.italic=f.italic,f.alignment&&(r.format.alignment=f.alignment),r.offset.x=u.width/t.scale_x,r.offset.y=u.height/t.scale_y,r.rotation=t.rotation,r.flipx=parseInt(t.flip_x),r.flipy=parseInt(t.flip_y),r.scalex=t.scale_x,r.scaley=t.scale_y,r.width=t.width,r.height=t.height,r.curvedline.enabled=e.enabled,r.curvedline.left.x=e.left.x,r.curvedline.left.y=e.left.y,r.curvedline.anchorleft.x=e.anchorleft.x,r.curvedline.anchorleft.y=e.anchorleft.y,r.curvedline.anchorright.x=e.anchorright.x,r.curvedline.anchorright.y=e.anchorright.y,r.curvedline.startheight=e.startheight,r.curvedline.startwidth=e.startwidth,r.curvedline.right.x=e.right.x,r.curvedline.right.y=e.right.y,r.curvedline.type=e.type,r.groupid=t.group_id,r.start(),i.drawningboard.selector.setnewclipstate(r),i.drawningboard.clipid++)}),i.drawningboard.icon&&i.drawningboard.firstdisplay&&(i.drawningboard.firstdisplay=!1,i.drawningboard.mode=="preview"&&(i.drawningboard.isSave=!0,i.drawningboard.flowtab.preview()))),i.drawningboard.selector.refreshindex(),i.drawningboard.selector.settarget(i.drawningboard.cliplist),i.drawningboard.selector.select(i.drawningboard.cliplist,!1),f=i.drawningboard.selector.getclipdata(i.drawningboard.selector.target),f.width>i.drawningboard.width||f.height>i.drawningboard.height){var o=i.drawningboard.width/f.width,s=i.drawningboard.height/f.height,e=1;e=o<s?o:s;i.drawningboard.selector.setscale(e,e);i.drawningboard.selector.contextaction=!0;i.drawningboard.selector.contextrelease()}i.drawningboard.selector.changed=1;i.drawningboard.selector.save();i.drawningboard.selector.unselect();i.hide()};i.okediticon=function(){i.drawningboard.reset();i.hide();setTimeout(function(){i.adding=!1;i.drawningboard.editiconid=i.selected.parent().attr("svgid");i.proccessaddlogo()},500)};i.canceleditcon=function(){i.adding=!1;i.drawningboard.editiconid=undefined};i.addlogo=function(){i.adding||(i.adding=!0,i.proccessaddlogo())};i.editicon=function(){if(!i.adding){i.adding=!0;var n=new Messagebox(i.drawningboard,i.drawningboard.api.dictionary.adddialog_icon_edit_message,i.okediticon,i.drawningboard.api.dictionary.ok,i.drawningboard.api.dictionary.cancel,i.canceleditcon);n.show();return}}}